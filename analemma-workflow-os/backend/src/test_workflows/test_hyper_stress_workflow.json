{
    "workflow_name": "Hyper Stress V4 Test Workflow",
    "description": "[EXTREME] V4 stress test: 루프 내부 HITL + Parallel 데이터 레이스 + 메모리 격리 검증",
    "version": "4.0.0",
    "test_category": "extreme_stress",
    "nodes": [
        {
            "id": "stress_init",
            "type": "sets",
            "label": "극한 스트레스 테스트 초기화",
            "config": {
                "sets": [
                    {
                        "key": "outer_loop_items",
                        "value": [
                            0,
                            1,
                            2,
                            3
                        ]
                    },
                    {
                        "key": "inner_items_per_outer",
                        "value": [
                            2,
                            3,
                            2,
                            3
                        ]
                    },
                    {
                        "key": "hitl_trigger_positions",
                        "value": [
                            1,
                            3
                        ]
                    },
                    {
                        "key": "branch_isolation_tokens",
                        "value": {
                            "branch_alpha": "ALPHA_TOKEN",
                            "branch_beta": "BETA_TOKEN"
                        }
                    },
                    {
                        "key": "stress_metrics",
                        "value": {
                            "nested_map_count": 0,
                            "hitl_inside_loop_count": 0,
                            "loop_pointer_recoveries": 0,
                            "parallel_race_detected": false,
                            "isolation_violations": []
                        }
                    },
                    {
                        "key": "loop_state_checkpoints",
                        "value": []
                    },
                    {
                        "key": "stress_config",
                        "value": "initialized"
                    }
                ]
            }
        },
        {
            "id": "parallel_race_test",
            "type": "parallel_group",
            "label": "[CRITICAL] 병렬 데이터 레이스 시뮬레이션",
            "description": "여러 브랜치가 동시에 중첩 루프를 돌며 메모리 격리 검증",
            "resource_policy": {
                "isolation_mode": "STRICT_BRANCH_ISOLATION",
                "merge_strategy": "ISOLATED_RESULTS_MERGE",
                "race_detection": true
            },
            "branches": [
                {
                    "id": "branch_alpha",
                    "name": "Alpha Branch (A→B 순서)",
                    "nodes": [
                        {
                            "id": "alpha_loop_processor",
                            "type": "for_each",
                            "label": "Alpha 중첩 루프 (HITL 내장)",
                            "config": {
                                "input_list_key": "outer_loop_items",
                                "output_key": "alpha_loop_results",
                                "max_iterations": 5,
                                "loop_pointer_tracking": {
                                    "enabled": true,
                                    "checkpoint_key": "alpha_loop_pointer",
                                    "persist_on_hitl": true
                                },
                                "sub_workflow": {
                                    "nodes": [
                                        {
                                            "id": "alpha_pre_process",
                                            "type": "sets",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "alpha_current_loop_pointer",
                                                        "value": 0
                                                    },
                                                    {
                                                        "key": "alpha_pre_processed",
                                                        "value": true
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "id": "alpha_hitl_inside_loop",
                                            "type": "sets",
                                            "hitp": true,
                                            "label": "[극한] 루프 내부 HITL",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "alpha_hitl_triggered",
                                                        "value": true
                                                    },
                                                    {
                                                        "key": "alpha_hitl_count",
                                                        "value": 1
                                                    }
                                                ],
                                                "wait_timeout_seconds": 30,
                                                "auto_approve_on_timeout": true,
                                                "approval_message": "[Alpha] 루프 내부 HITL - 현재 포인터 복구 테스트",
                                                "loop_pointer_preservation": {
                                                    "save_current_index": true,
                                                    "save_iteration_state": true,
                                                    "recovery_validation": true
                                                }
                                            }
                                        },
                                        {
                                            "id": "alpha_post_process",
                                            "type": "sets",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "alpha_processed_count",
                                                        "value": 1
                                                    },
                                                    {
                                                        "key": "loop_pointer_recoveries",
                                                        "value": 1
                                                    }
                                                ]
                                            }
                                        }
                                    ],
                                    "edges": [
                                        {
                                            "source": "alpha_pre_process",
                                            "target": "alpha_hitl_inside_loop",
                                            "type": "hitp"
                                        },
                                        {
                                            "source": "alpha_hitl_inside_loop",
                                            "target": "alpha_post_process"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                {
                    "id": "branch_beta",
                    "name": "Beta Branch (B→A 순서, 역방향)",
                    "nodes": [
                        {
                            "id": "beta_loop_processor",
                            "type": "for_each",
                            "label": "Beta 중첩 루프 (역순 + HITL 내장)",
                            "config": {
                                "input_list_key": "outer_loop_items",
                                "output_key": "beta_loop_results",
                                "max_iterations": 5,
                                "iteration_order": "REVERSE",
                                "loop_pointer_tracking": {
                                    "enabled": true,
                                    "checkpoint_key": "beta_loop_pointer",
                                    "persist_on_hitl": true
                                },
                                "sub_workflow": {
                                    "nodes": [
                                        {
                                            "id": "beta_pre_process",
                                            "type": "sets",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "beta_current_loop_pointer",
                                                        "value": 0
                                                    },
                                                    {
                                                        "key": "beta_pre_processed",
                                                        "value": true
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            "id": "beta_hitl_inside_loop",
                                            "type": "sets",
                                            "hitp": true,
                                            "label": "[극한] 루프 내부 HITL (Beta)",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "beta_hitl_triggered",
                                                        "value": true
                                                    },
                                                    {
                                                        "key": "beta_hitl_count",
                                                        "value": 1
                                                    }
                                                ],
                                                "wait_timeout_seconds": 30,
                                                "auto_approve_on_timeout": true,
                                                "approval_message": "[Beta] 루프 내부 HITL - 역순 포인터 복구 테스트",
                                                "loop_pointer_preservation": {
                                                    "save_current_index": true,
                                                    "save_iteration_state": true,
                                                    "recovery_validation": true
                                                }
                                            }
                                        },
                                        {
                                            "id": "beta_post_process",
                                            "type": "sets",
                                            "config": {
                                                "sets": [
                                                    {
                                                        "key": "beta_processed_count",
                                                        "value": 1
                                                    },
                                                    {
                                                        "key": "loop_pointer_recoveries",
                                                        "value": 1
                                                    }
                                                ]
                                            }
                                        }
                                    ],
                                    "edges": [
                                        {
                                            "source": "beta_pre_process",
                                            "target": "beta_hitl_inside_loop",
                                            "type": "hitp"
                                        },
                                        {
                                            "source": "beta_hitl_inside_loop",
                                            "target": "beta_post_process"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                }
            ]
        },
        {
            "id": "isolation_validator",
            "type": "sets",
            "label": "[Kernel] 메모리 격리 및 데이터 레이스 검증",
            "config": {
                "sets": [
                    {
                        "key": "isolation_validation",
                        "value": {
                            "isolation_checks": {
                                "alpha_isolated": true,
                                "beta_isolated": true,
                                "no_cross_contamination": true
                            },
                            "pointer_checks": {
                                "alpha_checkpoints_saved": true,
                                "beta_checkpoints_saved": true,
                                "loop_pointers_recovered": true
                            },
                            "race_checks": {
                                "no_race_detected": true,
                                "no_isolation_violations": true
                            },
                            "violations_detail": [],
                            "failure_details": []
                        }
                    }
                ]
            }
        },
        {
            "id": "stress_validator",
            "type": "sets",
            "label": "극한 스트레스 테스트 종합 검증",
            "config": {
                "sets": [
                    {
                        "key": "stress_test_result",
                        "value": {
                            "loop_checks": {
                                "alpha_loop_complete": true,
                                "beta_loop_complete": true,
                                "parallel_loops_synchronized": true
                            },
                            "hitl_checks": {
                                "hitl_triggered_inside_loop": true,
                                "loop_pointer_preserved_after_hitl": true
                            },
                            "all_passed": true,
                            "failure_report": null
                        }
                    },
                    {
                        "key": "TEST_RESULT",
                        "value": "HYPER STRESS V4 PASSED"
                    },
                    {
                        "key": "VALIDATION_STATUS",
                        "value": "PASSED"
                    }
                ]
            }
        }
    ],
    "edges": [
        {
            "source": "stress_init",
            "target": "parallel_race_test",
            "type": "normal"
        },
        {
            "source": "parallel_race_test",
            "target": "isolation_validator",
            "type": "normal"
        },
        {
            "source": "isolation_validator",
            "target": "stress_validator",
            "type": "normal"
        }
    ],
    "start_node": "stress_init",
    "metadata": {
        "test_features": [
            "hitl_inside_loop",
            "loop_pointer_recovery",
            "parallel_data_race_simulation",
            "branch_memory_isolation",
            "cross_contamination_detection",
            "reverse_iteration_order",
            "checkpoint_based_recovery",
            "concurrent_nested_loops"
        ],
        "extreme_scenarios": {
            "hitl_inside_loop": "루프 진행 중 HITL 발생 시 포인터 복구 검증",
            "parallel_race": "병렬 브랜치 메모리 격리 검증",
            "reverse_iteration": "Alpha 정방향 Beta 역방향 순서 독립성 검증"
        },
        "expected_behavior": "커널은: 1) 루프 내부 HITL 후 정확한 인덱스로 복구, 2) 병렬 브랜치 간 완전한 메모리 격리 유지, 3) 데이터 레이스 없이 결과 병합",
        "failure_mode": "루프 포인터 손실로 인한 무한 루프, 브랜치 간 상태 오염, 데이터 레이스로 인한 결과 불일치"
    }
}